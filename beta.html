<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTRL Turbo Tribe Racing League</title>
    <!-- Tailwind script removed from here, moved to end of body -->

    <!-- Google Fonts: Oswald (headings) and Inter (body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Unified font import -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">


    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- three.js (for loading screen) -->
    <!-- Added defer to prevent render-blocking -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
    
    <!-- GSAP (for loading screen) - Will be imported as module -->


        <style>
        /* Base body styles */
        body {
            /* background-color: #030712; */ /* MOVED to fallback div */
            background-color: transparent; /* Make body transparent */
            font-family: 'Inter', sans-serif;
            color: #E0E0E0; /* text-gray-300 -> NEW LIGHT GRAY */
        }
        
        /* NEW Fallback background */
        #video-fallback-bg {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background-color: #000000; /* Solid black/blue -> NEW BLACK */
             z-index: -2; /* Behind video */
        }
        
        /* --- NEW VIDEO BACKGROUND --- */
        #scroll-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center; /* Ensure video is centered */
            z-index: -1; /* Behind all content, but above fallback */
            opacity: 0.4; /* Dim the video so content is readable */
        }

        /* --- F1-STYLE TYPOGRAPHY --- */
        /* Apply Oswald font to all major headings and modal titles */
        h1, h2, h3, h4, .tab-button, #modal-gp, #modal-title {
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase; /* F1 style is very uppercase */
            font-weight: 700;
            letter-spacing: 0.05em; /* Add a little space */
        }

        /* Countdown timer numbers */
        #countdown-section .countdown-box span:first-child {
            font-family: 'Oswald', sans-serif;
            font-weight: 500;
        }

        /* --- NEW HERO SECTION STYLE (Video) --- */
        .hero-bg {
            /* background-image REMOVED */
            background: transparent;
            min-height: 75vh;
            position: relative;
        }
        .hero-text-shadow { text-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); }

        /* --- CALENDAR SECTION BACKGROUND (Video) --- */
        #calendar {
            /* background-image REMOVED */
            background: transparent;
            position: relative;
        }

        /* --- REGISTRATION SECTION BACKGROUND (Video) --- */
        #register {
            /* background-image REMOVED */
            background-color: #000000; /* NEW: Solid background -> NEW BLACK */
            position: relative;
        }
        #register .container { position: relative; z-index: 1; }

        /* --- INNOVATIVE HOVER & SECTION STYLES --- */
        /* --- Cursor Styles --- */
        body { cursor: auto; }
        a, button, .calendar-card[data-round] { cursor: pointer; }

        /* Glowing button effect */
        .btn-glow {
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 69, 58, 0.2); /* NEW RED */
        }
        .btn-glow:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(255, 69, 58, 0.4); /* NEW RED */
        }


        /* --- NEW Card Overlay Effect (Calendar) --- */
        .calendar-card {
            position: relative;
            overflow: hidden; /* Contain the overlay */
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            --active-color: #FF453A; /* Default to TTRL Red -> NEW RED */
        }
        
        /* The circular overlay */
        .calendar-card::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px; /* Start small */
            height: 20px; /* Start small */
            border-radius: 50%;
            background: var(--active-color);
            opacity: 0.8;
            transform: translate(-50%, -50%) scale(0); /* Start at center, scaled to 0 */
            transition: transform 0.4s cubic-bezier(0.5, 1, 0.89, 1);
            z-index: 1;
        }
        
        .calendar-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 24px 36px rgba(0,0,0,0.11),
                0 24px 46px rgba(0,0,0,0.1);
        }
        
        /* Scale the overlay to fill the card */
        .calendar-card:hover::after {
            transform: translate(-50%, -50%) scale(20); /* Scale up to cover card */
        }

        /* Card Content (Sits on top of overlay) */
        .calendar-card .card-content {
            position: relative;
            z-index: 2;
            background: transparent; /* Was bg-gray-800/70 */
            transition: all 0.3s ease-out;
            /* Ensure content respects padding */
            width: 100%;
            height: 100%;
        }

        /* Text color transitions */
        .calendar-card:hover .card-date,
        .calendar-card .card-gp,
        .calendar-card .card-track {
            transition: color 0.3s ease-out;
        }
        
        .calendar-card:hover .card-date { color: #ff9e97; /* Lighter pink -> NEW LIGHTER RED */ }
        .calendar-card:hover .card-gp { color: #FFFFFF; }
        .calendar-card:hover .card-track { color: #E0E0E0; /* text-gray-300 -> NEW LIGHT GRAY */ }
        
        /* --- END Card Overlay Effect --- */


        /* --- TEAM COLORS (Text & Background) --- */
        /* Text Colors */
        .team-ferrari      { color: #DC0000; }
        .team-williams     { color: #0082FA; }
        .team-alpine       { color: #0090FF; }
        .team-haas         { color: #B6B6B8; }
        .team-mclaren      { color: #FF8700; }
        .team-kick-sauber  { color: #52E252; }
        .team-aston-martin { color: #006F62; }
        .team-racing-bulls { color: #469BFF; }
        .team-mercedes     { color: #00D2BE; }
        .team-red-bull     { color: #0600EF; }
        /* .team-reserve      { color: #888888; } */ /* Removed Reserve */

        /* --- OTHER STYLES --- */
        /* Custom scrollbar (Now hidden) */
        body::-webkit-scrollbar {
            display: none; /* Hide default scrollbar */
        }
        body {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
            overflow-y: scroll; /* Ensure body is scrollable */
        }

        /* Standings tabs and reset button */
        .tab-active { background-color: #FF453A; color: #FFFFFF; } /* NEW RED */
        .tab-inactive { background-color: #111111; color: #E0E0E0; } /* NEW OFF-BLACK & LIGHT GRAY */

        /* Modal styles */
        .modal { transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }

        /* p5.js Section Styling (REMOVED) */
        #standings, #contact {
            position: relative; 
            overflow: hidden; 
            background-color: #000000; /* NEW: Solid background -> NEW BLACK */
        }
        #standings > .container, #contact > .container {
            position: relative; /* Ensure content is on top of video */
            z-index: 2;
        }
        /* Style for the p5.js canvas (REMOVED) */
        #standings > canvas, #contact > canvas {
           display: none; /* Hide p5 canvas */
        }


        /* --- NEW DRIVER CARD STYLES (Nike Style) --- */
         #driver-card-grid {
            font-family: 'Inter', sans-serif; /* Use Inter for base card font */
            position: relative;
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columns for mobile */
            gap: 1.5rem; /* Smaller gap for mobile */
            justify-items: stretch; /* Stretch items to fill column */
            align-items: stretch; /* Ensure cards in a row have same height */
        }
        
        /* 3 columns for tablet */
        @media (min-width: 768px) {
            #driver-card-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 2rem; /* Restore gap */
            }
        }
        
        /* 5 columns for desktop */
        @media (min-width: 1024px) {
            #driver-card-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }


        #driver-card-grid .card {
            position: relative;
            width: 100%; /* Fill the grid column */
            height: 400px; /* CHANGED: Increased height again */
            /* MODIFIED: Adjusted gradient to show more color */
            background: linear-gradient(145deg, var(--color, #e11d48) 20%, #232323 90%);
            border-radius: 20px;
            overflow: hidden;
            color: #fff; /* Default text color */
        }

        #driver-card-grid .card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* MODIFIED: Changed to a subtle overlay/sheen */
            background: linear-gradient(145deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%);
            clip-path: circle(100px at 80% 20%); /* Smaller circle */
            transition: 0.5s ease-in-out;
            opacity: 0; /* MODIFIED: Start hidden */
        }

        #driver-card-grid .card:hover:before {
            clip-path: circle(300px at 80% -20%);
            opacity: 1; /* MODIFIED: Show sheen on hover */
        }

        /* Removed background text (:after) for drivers */

        #driver-card-grid .card .imgBx {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10000;
            width: 100%;
            height: 200px; /* CHANGED: Half of 400px */
            transition: 0.5s;
        }

        #driver-card-grid .card:hover .imgBx {
            top: 0%;
            transform: translateY(0%);
        }

        #driver-card-grid .card .imgBx img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the logo */
            width: 70%; /* Scale with card */
            max-width: 180px; /* But don't get too big */
            height: auto;
            object-fit: contain;
        }

        #driver-card-grid .card .contentBx {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100px; /* Initial height */
            text-align: center;
            transition: 1s;
            z-index: 10;
        }

        #driver-card-grid .card:hover .contentBx {
            height: 200px; /* CHANGED: Half of 400px */
        }

        #driver-card-grid .card .contentBx h2 {
            position: relative;
            font-weight: 600;
            letter-spacing: 1px;
            color: #fff;
            margin: 0;
            font-family: 'Oswald', sans-serif; /* OSWALD */
            font-size: 1.3rem; /* Reduced font size */
            text-transform: uppercase;
        }

        /* --- NEW: Always visible points --- */
        #driver-card-grid .card .contentBx .points-display {
            position: relative;
            display: inline-block; /* Allows margin:auto centering */
            padding: 2px 8px;
            margin-top: 8px; /* Space from name */
            font-family: 'Inter', sans-serif; /* INTER */
            font-size: 14px;
            color: #111;
            background: #fff;
            border-radius: 4px;
            font-weight: 500; /* Bolder */
            transition: 0.5s;
            /* Ensure it's visible */
            opacity: 1;
            visibility: visible;
        }

        #driver-card-grid .card:hover .contentBx .points-display {
            /* Move points up slightly on hover to make room for Pos */
            transform: translateY(-2px);
            transition-delay: 0.2s; /* Delay it slightly */
        }
        /* --- END NEW --- */


        /* Using .details for Pos/Points */
        #driver-card-grid .card .contentBx .details {
            display: flex;
            flex-direction: column; /* Stack details vertically */
            justify-content: center;
            align-items: center;
            padding: 8px 20px;
            transition: 0.5s;
            opacity: 0; /* Hidden by default */
            visibility: hidden; /* Hidden by default */
            padding-top: 0;
            padding-bottom: 0;
            /* NEW: Add margin top to clear the points */
            margin-top: 8px;
        }

        #driver-card-grid .card:hover .contentBx .details {
            opacity: 1;
            visibility: visible;
            transition-delay: 0.5s;
        }

        #driver-card-grid .card .contentBx .details .detail-item {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 5px; /* Space between pos and points */
        }


        #driver-card-grid .card .contentBx .details h3 {
            color: #fff;
            font-weight: 300;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-right: 10px;
            font-family: 'Inter', sans-serif; /* INTER */
        }

        #driver-card-grid .card .contentBx .details span {
            /* width: auto; */ /* Let width adjust */
            padding: 2px 8px; /* Padding for value */
            line-height: 22px; /* Adjust line height */
            font-size: 14px;
            display: inline-block;
            color: #111;
            background: #fff;
            margin: 0 5px;
            transition: 0.5s;
            border-radius: 4px;
            cursor: default; /* Not clickable */
            font-family: 'Inter', sans-serif; /* INTER */
        }

        #driver-card-grid .card .contentBx .details span:hover {
            background: var(--color, #9bdc28); /* Hover with team color */
            color: #111;
        }
        /* --- END DRIVER CARD STYLES --- */


        /* --- NEW CONSTRUCTOR CARD STYLES (Carousel) --- */
        #constructors-list-container {
            position: relative;
            z-index: 1;
            overflow: visible; /* Allow box shadow */
            padding-bottom: 2rem; /* Space for shadow */
            /* Removed grid styles, carousel.js handles layout */
        }
        
        /* Container for the carousel JS to hook into */
        #constructors-list-container .carousel {
            position: relative;
            z-index: 1;
            height: 500px; /* Give carousel a fixed height */
            overflow: hidden;
            pointer-events: none; /* JS will re-enable on items */
        }

        #constructors-list-container .carousel-item {
            --items: 10;
            --width: clamp(250px, 30vw, 300px); /* Responsive width */
            --height: clamp(350px, 40vw, 400px); /* Responsive height */
            --x: calc(var(--active) * 800%);
            --y: calc(var(--active) * 200%);
            --rot: calc(var(--active) * 120deg);
            --opacity: calc(var(--zIndex) / var(--items) * 3 - 2);
            overflow: hidden;
            position: absolute;
            z-index: var(--zIndex);
            width: var(--width);
            height: var(--height);
            margin: calc(var(--height) * -0.5) 0 0 calc(var(--width) * -0.5);
            border-radius: 10px;
            top: 50%;
            left: 50%;
            user-select: none;
            transform-origin: 0% 100%;
            box-shadow: 0 10px 50px 10px rgba(0, 0, 0, .5);
            /* MODIFIED: Use the team color for a gradient background */
            background: linear-gradient(145deg, var(--color, #e11d48) 20%, #232323 90%);
            pointer-events: all;
            transform: translate(var(--x), var(--y)) rotate(var(--rot)) ;
            transition: transform .8s cubic-bezier(0, 0.02, 0, 1);
        }

        #constructors-list-container .carousel-box {
            position: absolute;
            z-index: 1;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity .8s cubic-bezier(0, 0.02, 0, 1);
            opacity: var(--opacity);
            
            /* ADDED: Center image */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #constructors-list-container .carousel-box:before {
            content: '';
            position: absolute;
            z-index: 1;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0, 0, 0, .3), rgba(0, 0, 0, 0) 30%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, .5));
        }

        #constructors-list-container .title {
            position: absolute;
            z-index: 0; /* MODIFIED: Set to 0 (bottom layer) */
            color: #fff;
            /* bottom: 35px; */ /* MODIFIED: Removed old positioning */
            /* left: 20px; */ /* MODIFIED: Removed old positioning */

            /* --- NEW POSITIONING --- */
            /* top: 90%; */ /* MODIFIED: Removed old positioning */
            /* left: 50%; */
            /* transform: translateX(-50%); */
            /* width: 100%; */
            /* text-align: center; */
            
            bottom: 20px; /* Align with drivers info */
            left: 20px;
            writing-mode: vertical-lr;
            transform: rotate(180deg); /* Makes text read from bottom-to-top */
            /* --- END NEW POSITIONING --- */

            transition: opacity .8s cubic-bezier(0, 0.02, 0, 1);
            font-size: clamp(20px, 3vw, 30px);
            text-shadow: 0 4px 4px rgba(0, 0, 0, .1);
            font-family: 'Oswald', sans-serif; /* OSWALD */
            text-transform: uppercase;
        }

        #constructors-list-container .num {
            position: absolute;
            z-index: 2; /* MODIFIED: Set to 2 (above image) */
            color: #fff;
            top: 10px;
            left: 20px;
            transition: opacity .8s cubic-bezier(0, 0.02, 0, 1);
            font-size: clamp(40px, 10vw, 80px); /* Larger num */
            font-family: 'Oswald', sans-serif; /* OSWALD */
            font-weight: 700;
        }
        
        /* NEW: Driver points details */
        #constructors-list-container .drivers {
            position: absolute;
            z-index: 3; /* MODIFIED: Set to 3 (top layer) */
            color: #fff;
            bottom: 20px;
            right: 20px;
            transition: opacity .8s cubic-bezier(0, 0.02, 0, 1);
            font-family: 'Inter', sans-serif; /* INTER */
            font-size: 0.8rem;
            text-align: right;
            text-shadow: 0 2px 2px rgba(0, 0, 0, .3);
        }
        #constructors-list-container .drivers .team-points {
            font-family: 'Oswald', sans-serif; /* OSWALD */
            font-size: 1.2rem;
            font-weight: 700;
            display: block;
            margin-bottom: 5px;
        }
         #constructors-list-container .drivers span {
            display: block; /* Each driver on new line */
         }
        /* END: Driver points details */


        #constructors-list-container .carousel-item img {
            /* MODIFIED: Don't fill, just contain and scale */
            width: 80%;
            height: 80%;
            object-fit: contain; /* Changed from 'cover' */
            pointer-events: none;
            /* MODIFIED: Add a slight drop-shadow */
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
            
            /* --- NEW --- */
            position: relative;
            z-index: 1; /* MODIFIED: Set to 1 (above title, below num/drivers) */
            /* --- END NEW --- */
        }

        /* Carousel Cursors */
        .cursor {
            position: fixed;
            z-index: 9999; /* High z-index */
            top: 0;
            left: 0;
            --size: 40px;
            width: var(--size);
            height: var(--size);
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, .2);
            margin: calc(var(--size) * -0.5) 0 0 calc(var(--size) * -0.5);
            transition: transform .85s cubic-bezier(0, 0.02, 0, 1);
            display: none;
            pointer-events: none;
        }

        .cursor2 {
            --size: 2px;
            transition-duration: .7s;
        }
        
        /* Show cursor only on desktop */
        @media (pointer: fine) {
            .cursor {
                display: block;
            }
        }
        /* --- END CONSTRUCTOR CARD STYLES --- */


        /* --- Loading Screen Styles (three.js) --- */
        #loading-screen {
            position: fixed; inset: 0; 
            background-color: #202020; /* Match scene bg */
            display: flex; /* Keep for centering if needed */
            align-items: center; 
            justify-content: center;
            z-index: 100; opacity: 1;
            transition: opacity 0.5s ease-out 3.5s, visibility 0.5s ease-out 3.5s;
            visibility: visible;
        }
        #loading-screen.hidden { 
            opacity: 0; 
            visibility: hidden; 
            pointer-events: none; 
        }
        /* Canvas will be injected here */
        #loading-screen canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        /* Footer for loader */
        #loading-footer {
            color: #4b5563;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            padding: 10px;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 101; /* Above canvas */
            text-align: center;
        }
        /* --- END Loading Screen Styles --- */


        /* --- NEW OVERLAY NAVIGATION STYLES --- */
        .overlay-navigation {
            position: fixed;
            z-index: 99;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: hsla(0, 0%, 0%, 0.8);
            transform: translateY(-100%);
            visibility: hidden; /* Start hidden */
            transition: transform .4s ease-in-out, visibility 0s .4s;
        }

        .overlay-navigation.overlay-active {
            transform: translateY(0);
            visibility: visible;
            transition: transform .4s ease-in-out;
        }


        nav,
        nav ul {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            flex-basis: 20%;
            justify-content: center;
            align-items: center;
            height: 100%;
            overflow: hidden;
            transform: translateY(-100%);
            transition: transform 0.3s ease-in-out; /* Default close transition */
        }
        
        /* Nav Item Animations */
        .overlay-active nav ul li {
            transform: translateY(0);
        }
        
        /* FIXED: Corrected nth-of-type selectors to apply delays */
        .overlay-active nav ul li:nth-of-type(1) { transition: transform 0.4s ease-in-out 0.2s; }
        .overlay-active nav ul li:nth-of-type(2) { transition: transform 0.4s ease-in-out 0.3s; }
        .overlay-active nav ul li:nth-of-type(3) { transition: transform 0.4s ease-in-out 0.4s; }
        .overlay-active nav ul li:nth-of-type(4) { transition: transform 0.4s ease-in-out 0.5s; }
        .overlay-active nav ul li:nth-of-type(5) { transition: transform 0.4s ease-in-out 0.6s; }

        .overlay-navigation.overlay-slide-up nav ul li {
             transform: translateY(-100%);
        }
        /* Close transition delays */
        .overlay-navigation.overlay-slide-up nav li:nth-of-type(1) { transition-delay: 0.5s; }
        .overlay-navigation.overlay-slide-up nav li:nth-of-type(2) { transition-delay: 0.4s; }
        .overlay-navigation.overlay-slide-up nav li:nth-of-type(3) { transition-delay: 0.3s; }
        .overlay-navigation.overlay-slide-up nav li:nth-of-type(4) { transition-delay: 0.2s; }
        .overlay-navigation.overlay-slide-up nav li:nth-of-type(5) { transition-delay: 0.1s; }
        

        nav li a {
            position: relative;
            top: 46%;
            color: #fff;
            text-transform: uppercase;
            font-family: 'Oswald', sans-serif; /* OSWALD */
            font-weight: 300;
            letter-spacing: 4px;
            text-decoration: none;
            display: block;
            text-align: center;
            font-size: 0.9rem;
        }

        nav li a:before {
            content: '';
            width: 70px;
            height: 2px;
            background-color: #fff;
            position: absolute;
            top: 50%;
            left: 0;
            z-index: 100;
            transform: translateX(-100%);
            opacity: 0;
            transition: all .2s linear;
        }

        nav li a:after {
            content: attr(data-content);
            font-size: 0.7rem;
            transition: all .2s linear;
            opacity: 0;
            position: absolute;
            z-index: 100;
            color: #fff;
            display: block;
            margin-right: auto;
            margin-left: auto;
            left: 0;
            right: 0;
            bottom: -50px;
            text-transform: none;
            font-family: 'Inter', sans-serif; /* INTER */
            font-weight: 300;
            font-style: italic;
            letter-spacing: 0;
        }

        nav li a:hover:before {
            transform: translateX(0);
            opacity: 1;
        }

        nav li a:hover:after {
            transform: translateY(15px);
            opacity: 1;
        }

        /* TTRL Theme Colors for Nav (Order Swapped) */
        nav li:nth-of-type(1){background-color: #FF453A} /* TTRL Red (Home) -> NEW RED */
        nav li:nth-of-type(2){background-color: #cc2b20} /* Darker Red (Calendar) -> NEW DARKER RED */
        nav li:nth-of-type(3){background-color: #111111} /* Gray (Standings) -> NEW OFF-BLACK */
        nav li:nth-of-type(4){background-color: #000000} /* Darkest Gray (Enrollment) -> NEW BLACK */
        nav li:nth-of-type(5){background-color: #111111} /* Darker Gray (Contact) -> NEW OFF-BLACK */

        /* Burger Menu Button (NEW SVG Button) */
        .menu {
            --color: #fff;
            width: 36px;
            height: 36px;
            padding: 0;
            margin: 0;
            outline: none;
            position: relative;
            border: none;
            background: none;
            cursor: pointer;
            -webkit-appearance: none;
            -webkit-tap-highlight-color: transparent;
            z-index: 100; /* Ensure it's above overlay */
        }
        .menu svg {
            width: 64px;
            height: 48px;
            top: -6px;
            left: -14px;
            stroke: var(--color);
            stroke-width: 4px;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
            display: block;
            position: absolute;
        }
        .menu path {
            transition: stroke-dasharray var(--duration, .85s) var(--easing, ease) var(--delay, 0s), stroke-dashoffset var(--duration, .85s) var(--easing, ease) var(--delay, 0s);
            stroke-dasharray: var(--array-1, 26px) var(--array-2, 100px);
            stroke-dashoffset: var(--offset, 126px);
            transform: translateZ(0);
        }
        .menu path:nth-child(2) {
            --duration: .7s;
            --easing: ease-in;
            --offset: 100px;
            --array-2: 74px;
        }
        .menu path:nth-child(3) {
            --offset: 133px;
            --array-2: 107px;
        }
        .menu.active svg {
            stroke: #FF453A; /* Red when active -> NEW RED */
        }
        .menu.active path {
            --offset: 57px;
        }
        .menu.active path:nth-child(1),
        .menu.active path:nth-child(3) {
            --delay: .15s;
            --easing: cubic-bezier(.2, .4, .2, 1.1);
        }
        .menu.active path:nth-child(2) {
            --duration: .4s;
            --offset: 2px;
            --array-1: 1px;
        }
        .menu.active path:nth-child(3) {
            --offset: 58px;
        }
        /* --- END SVG Menu Button --- */

        
        /* Media query for mobile nav */
        @media (max-width: 640px) {
            nav ul {
                flex-direction: column; /* Stack vertically on mobile */
            }
            nav ul li {
                flex-basis: 20%; /* Each takes full width */
            }
            nav li a {
                font-size: 11px;
            }
            nav li a:after {
                font-size: 0.6rem;
            }
            nav li a:before {
                width: 15px;
            }
        }
        
        /* Layout/Logo styles from carousel */
        .layout {
            position: fixed; /* Changed to fixed */
            z-index: 10; /* Above video, below nav */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .layout:before {
            content: '';
            position: absolute;
            z-index: 1;
            top: 0;
            left: 90px;
            width: 10px;
            height: 100%;
            border: 1px solid #fff;
            border-top: none;
            border-bottom: none;
            opacity: .15;
        }

        .layout .box {
            position: absolute;
            bottom: 0;
            left: 30px;
            color: #fff;
            transform-origin: 0% 10%;
            transform: rotate(-90deg);
            font-size: 9px;
            line-height: 1.4;
            text-transform: uppercase;
            opacity: .4;
            font-family: 'Inter', sans-serif; /* INTER */
        }
        
        /* Removed .logo and .social */
        
        /* --- Compact Countdown Timer --- */
        #countdown-section .countdown {
            display: flex;
            justify-content: center;
            gap: 1rem;
            max-width: 28rem; /* Smaller max width */
            margin: 0 auto;
        }
        #countdown-section .countdown-box {
            background: rgba(17, 24, 39, 0.7); /* bg-gray-900/70 */
            border: 1px solid rgba(55, 65, 81, 1); /* border-gray-700 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
            text-align: center;
            flex-grow: 1; /* Each box takes equal space */
        }
        #countdown-section .countdown-box span:first-child {
            display: block;
            font-size: 2.25rem; /* text-4xl */
            line-height: 2.5rem; /* leading-10 */
            font-weight: 700; /* font-bold */
            color: #FFFFFF;
        }
        #countdown-section .countdown-box span:last-child {
            display: block;
            font-size: 0.75rem; /* text-xs */
            line-height: 1rem; /* leading-4 */
            font-weight: 500; /* font-medium */
            color: #E0E0E0; /* text-gray-400 -> NEW LIGHT GRAY */
            text-transform: uppercase;
        }
        #countdown-section .countdown-box.seconds span:first-child {
            color: #FF453A; /* text-rose-500 -> NEW RED */
        }
        @media (min-width: 640px) {
             #countdown-section .countdown-box span:first-child {
                 line-height: 1;
             }
             #countdown-section .countdown-box span:last-child {
                font-size: 0.875rem; /* text-sm */
                line-height: 1.25rem; /* leading-5 */
             }
        }
        /* --- End Compact Timer --- */

        /* --- REMOVED Curved Scrollbar CSS --- */
        
        /* --- REMOVED Curved Scrollbar CSS --- */
        
        /* --- NEW PALETTE OVERRIDES --- */
        /* These overrides will catch Tailwind classes used in the HTML */
        
        /* Backgrounds */
        footer#contact {
            background-color: #111111; /* Off-black for Footer */
        }
        .bg-gray-900 { background-color: #111111 !important; }
        .bg-gray-800, .bg-gray-800\/70 { background-color: rgba(30, 30, 30, 0.7) !important; } /* Dark gray w/ alpha */
        .bg-gray-950\/80 { background-color: rgba(0, 0, 0, 0.8) !important; } /* Black w/ alpha */
        
        /* Borders */
        .border-gray-700 { border-color: #111111 !important; }
        .border-gray-800 { border-color: #000000 !important; }
        
        /* Text */
        h1, h2, h3, h4, h5, h6, .text-white { color: #FFFFFF; }
        .text-gray-300, .text-gray-200 { color: #FFFFFF !important; }
        .text-gray-400 { color: #E0E0E0 !important; }
        .text-gray-500 { color: #E0E0E0 !important; opacity: 0.8; }

        /* Accents */
        .text-rose-600 { color: #FF453A !important; }
        .bg-rose-600 { background-color: #FF453A !important; }
        .text-rose-500 { color: #FF453A !important; }
        /* --- END NEW PALETTE OVERRIDES --- */
    </style>
    
    <!-- REMOVED STYLE TAG FOR SCROLLER KEYFRAMES -->
    <!-- <style id="curved-scroller-styles"></style> -->

</head>
<body class="bg-gray-950 text-gray-300">

    <!-- NEW Video Background -->
    <div id="video-fallback-bg"></div> <!-- Fallback bg -->
    <video id="scroll-video" muted playsinline preload="auto" loop>
        <!-- **** THIS IS THE MODIFIED VIDEO LINK **** -->
        <source src="https://github.com/S-HARISH44/TTRL/blob/f1c17381dffd8b98b43e169a8dfde2649e6f562a/RESOURCES/finals_comp_60_fps.mp4?raw=true" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    
    <!-- Carousel layout elements -->
    <div class="layout">
        <div class="box">TTRL Turbo Tribe<br />Racing League<br />Est. 2024</div>
    </div>
    
    <!-- Cursors for Carousel -->
    <div class="cursor"></div>
    <div class="cursor cursor2"></div>
    
    <!-- REMOVED Curved Scrollbar SVG -->


    <!-- NEW Overlay Navigation -->
    <div class="overlay-navigation">
        <nav role="navigation">
            <ul>
                <li class="nav-item"><a href="#home" data-content="Back to the Top">Home</a></li>
                <li class="nav-item"><a href="#calendar" data-content="See the Schedule">Calendar</a></li>
                <li class="nav-item"><a href="#standings" data-content="Who's on Top?">Standings</a></li>
                <li class="nav-item"><a href="#register" data-content="Join the Grid!">Enrollment</a></li>
                <li class="nav-item"><a href="#contact" data-content="Get in Touch">Contact</a></li>
            </ul>
        </nav>
    </div>

    <!-- Loading Screen (three.js) -->
    <div id="loading-screen">
        <!-- Canvas will be injected here -->
        <footer id="loading-footer">
            TTRL Loading...
        </footer>
    </div>

    <!-- Header / Navigation -->
    <header class="bg-gray-950/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-800">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <a href="#home" class="block">
                        <img src="https://raw.githubusercontent.com/HARISHWINNER/TTRL/ade50d630c482acbb96676fc69c2849a58494f7f/RESOURCES/image.png"
                             alt="TTRL Logo" class="h-12 w-auto">
                    </a>
                </div>
                
                <!-- NEW SVG Hamburger Menu Trigger -->
                <button class="menu open-overlay">
                    <svg viewBox="0 0 64 48">
                        <path d="M19,15 L45,15 C70,15 58,-2 49.0177126,7 L19,37"></path>
                        <path d="M19,24 L45,24 C61.2371586,24 57,49 41,33 L32,24"></path>
                        <path d="M45,33 L19,33 C-8,33 6,-2 22,14 L45,37"></path>
                    </svg>
                </button>
                
            </div>
        </nav>
    </header>

    <main>
        <!-- Home Section -->
        <section id="home" class="hero-bg relative flex items-center justify-center text-center overflow-hidden px-4 py-32">
            <div class="relative z-10">
                <h1 class="text-5xl sm:text-7xl lg:text-8xl font-extrabold text-white tracking-tight hero-text-shadow">
                    TTRL <span class="text-rose-600">TURBO TRIBE</span><br>RACING LEAGUE
                </h1>
                <p class="mt-6 text-lg sm:text-xl text-gray-300 max-w-3xl mx-auto hero-text-shadow">
                    The ultimate destination for competitive and realistic F1 25 sim racing.
                    Do you have what it takes to become a champion?
                </p>
                <div class="mt-12">
                    <a href="#register" class="inline-block px-10 py-4 bg-rose-600 text-white text-lg font-bold rounded-md shadow-lg btn-glow">
                        JOIN THE GRID
                    </a>
                </div>
            </div>
        </section>

        <!-- Countdown Timer Section -->
        <section id="countdown-section" class="py-12 sm:py-16 relative z-10"> <!-- Removed bg-gray-900 and border-b-4 -->
            <div class="container mx-auto px-4">
                <!-- Removed: bg-gray-800/50 backdrop-blur-sm border border-gray-700 shadow-2xl -->
                <div class="rounded-xl max-w-4xl mx-auto p-0 sm:p-8"> <!-- Removed padding -->
                    <div class="text-center">
                        <h2 class="text-3xl sm:text-4xl font-bold text-white mb-2">
                            NEXT RACE: <span id="next-race-gp" class="text-rose-500">LOADING...</span>
                        </h2>
                        <h3 id="next-race-track" class="text-xl sm:text-2xl font-medium text-gray-400 mb-8" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">
                            Calculating...
                        </h3>
                    </div>
                    <!-- NEW Compact Countdown -->
                    <div id="countdown" class="countdown">
                        <div class="countdown-box">
                            <span id="days">00</span>
                            <span>Days</span>
                        </div>
                        <div class="countdown-box">
                            <span id="hours">00</span>
                            <span>Hours</span>
                        </div>
                        <div class="countdown-box">
                            <span id="minutes">00</span>
                            <span>Minutes</span>
                        </div>
                        <div class="countdown-box seconds">
                            <span id="seconds">00</span>
                            <span>Seconds</span>
                        </div>
                    </div>
                    <!-- END Compact Countdown -->
                </div>
            </div>
        </section>

        <!-- Calendar Section -->
        <section id="calendar" class="py-24 relative">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-extrabold text-white sm:text-5xl">
                        LEAGUE <span class="text-rose-600">CALENDAR</span>
                    </h2>
                    <p class="mt-4 text-lg text-gray-200 max-w-2xl mx-auto" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">
                        Our 10-race championship spans the globe. Click a track for insights.
                    </p>
                </div>

                <!-- Calendar Grid -->
                <div id="calendar-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Calendar cards will be injected here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Standings Section -->
        <section id="standings" class="py-24 relative"> <!-- Removed border-y-4 -->
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-extrabold text-white sm:text-5xl">
                        CURRENT <span class="text-rose-600">STANDINGS</span>
                    </h2>
                    <p class="mt-4 text-lg text-gray-200 max-w-2xl mx-auto" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">
                        Who's leading the pack? See the latest points after the last round.
                    </p>
                </div>

                <!-- Standings Tabs -->
                <div class="flex justify-center items-center mb-8 gap-4">
                    <div class="flex space-x-2 sm:space-x-4">
                        <button id="drivers-tab" class="tab-button tab-active px-4 py-3 sm:px-6 font-bold text-base sm:text-lg rounded-md transition-all">DRIVER STANDINGS</button>
                        <button id="constructors-tab" class="tab-button tab-inactive px-4 py-3 sm:px-6 font-bold text-base sm:text-lg rounded-md transition-all">CONSTRUCTOR STANDINGS</button>
                    </div>
                </div>


                <!-- Standings Content Container -->
                <div> <!-- Removed max-w-4xl mx-auto -->
                    
                    <!-- NEW Driver Standings Card Grid (Nike Style) -->
                    <div id="drivers-table-container">
                        <div id="driver-card-grid">
                             <!-- Driver cards will be injected here -->
                        </div>
                         <!-- Added max-w-4xl mx-auto to this paragraph -->
                        <p class="text-center text-sm text-gray-200 mt-4 max-w-4xl mx-auto">Points after the Las Vegas GP</p>
                    </div>


                    <!-- NEW Constructor Standings Card List (Carousel Item Style) -->
                     <!-- Added max-w-4xl mx-auto to this container -->
                     <!-- Use inline style to hide by default, ensuring it's hidden before Tailwind loads -->
                    <div id="constructors-list-container" style="display: none;" class="max-w-4xl mx-auto">
                         <!-- Carousel will be injected here -->
                         <p class="text-center text-sm text-gray-200 mt-4" style="grid-column: 1 / -1;">Points after the Las Vegas GP. Click and drag cards to explore.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Registration Section -->
        <section id="register" class="py-24 text-center">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <i class="fa-solid fa-flag-checkered text-6xl text-rose-600 mb-6"></i>
                <h2 class="text-4xl font-extrabold text-white sm:text-5xl">
                    JOIN THE <span class="text-rose-600">GRID</span>
                </h2>
                <p class="mt-4 text-lg text-gray-200 max-w-2xl mx-auto" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">
                    Ready to prove your skill? Registrations are now open.
                    Fill out the Google Form to secure your spot for the upcoming season.
                </p>
                <div class="mt-12">
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLSc1xE8SkAOIKoHaryLjNgTNXJfmBCSv73vdgxaAA0_uxnmUTw/viewform?usp=sharing&ouid=104200385701338668462" target="_blank" rel="noopener noreferrer"
                       class="inline-block px-12 py-5 bg-rose-600 text-white text-xl font-bold rounded-lg shadow-xl btn-glow">
                        <i class="fa-brands fa-google-drive mr-2"></i> ENROLLMENT
                    </a>
                    <p class="mt-4 text-sm text-gray-500">You will be redirected to an external Google Form.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer / Contact Section -->
    <footer id="contact" class="bg-gray-900"> <!-- Removed border-t -->
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-16 relative z-10">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-extrabold text-white">
                    CONTACT & <span class="text-rose-600">COMMUNITY</span>
                </h2>
                <p class="mt-3 text-lg text-gray-400" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">
                    Get in touch with the league admins and join the conversation.
                </p>
            </div>

            <!-- Social Links Grid -->
            <div class="flex flex-wrap justify-center gap-6 text-3xl sm:text-4xl">
                <!-- Discord -->
                <a href="https://discord.gg/EuyPTXqbg6" target="_blank" rel="noopener noreferrer"
                   class="flex flex-col items-center group w-28 text-gray-400 hover:text-[#5865F2] transition-all duration-300">
                    <div class="p-5 bg-gray-800 rounded-full group-hover:bg-gray-700/50 group-hover:scale-110 border border-gray-700 group-hover:border-[#5865F2] transition-all duration-300">
                        <i class="fa-brands fa-discord"></i>
                    </div>
                    <span class="mt-3 text-sm font-medium uppercase tracking-wide">Discord</span>
                </a>

                <!-- YouTube -->
                <a href="https://www.youtube.com/@TurboTribeRacingLeague" target="_blank" rel="noopener noreferrer"
                   class="flex flex-col items-center group w-28 text-gray-400 hover:text-[#FF0000] transition-all duration-300">
                    <div class="p-5 bg-gray-800 rounded-full group-hover:bg-gray-700/50 group-hover:scale-110 border border-gray-700 group-hover:border-[#FF0000] transition-all duration-300">
                        <i class="fa-brands fa-youtube"></i>
                    </div>
                    <span class="mt-3 text-sm font-medium uppercase tracking-wide">Stream</span>
                </a>

                <!-- Email -->
                <a href="mailto:turbotriberacingleague@gmail.com"
                   class="flex flex-col items-center group w-28 text-gray-400 hover:text-[#3B82F6] transition-all duration-300">
                    <div class="p-5 bg-gray-800 rounded-full group-hover:bg-gray-700/50 group-hover:scale-110 border border-gray-700 group-hover:border-[#3B82F6] transition-all duration-300">
                        <i class="fa-solid fa-envelope"></i>
                    </div>
                    <span class="mt-3 text-sm font-medium uppercase tracking-wide">Email</span>
                </a>

                <!-- Steam -->
                <a href="https://steamcommunity.com/profiles/76561199497506530/" target="_blank" rel="noopener noreferrer"
                   class="flex flex-col items-center group w-28 text-gray-400 hover:text-white transition-all duration-300">
                    <div class="p-5 bg-gray-800 rounded-full group-hover:bg-gray-700/50 group-hover:scale-110 border border-gray-700 group-hover:border-white transition-all duration-300">
                        <i class="fa-brands fa-steam"></i>
                    </div>
                    <span class="mt-3 text-sm font-medium uppercase tracking-wide">Steam</span>
                </a>
            </div>

            <div class="mt-16 text-center text-gray-500 text-sm">
                <p>&copy; <span id="current-year"></span> TTRL Turbo Tribe Racing League. All rights reserved.</p>
                <p class="mt-1">This is an unofficial fan-run league and is not affiliated with Codemasters, EA, or Formula One.</p>
            </div>
        </div>
    </footer>

    <!-- Calendar Modal -->
    <div id="calendar-modal" class="modal fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" style="display: none; opacity: 0;" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div id="modal-backdrop" class="fixed inset-0"></div>
        <!-- Modal content -->
        <div class="modal-content bg-gray-900 w-full max-w-2xl rounded-xl shadow-2xl border border-gray-700 overflow-hidden relative z-10" style="transform: scale(0.95); opacity: 0;">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-5 border-b border-gray-700">
                <h3 id="modal-title" class="text-2xl font-bold text-white">Track Insights</h3>
                <button id="modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fa-solid fa-xmark fa-2x"></i>
                </button>
            </div>
            <!-- Modal Body -->
            <div class="p-0 max-h-[80vh] overflow-y-auto">
                <img id="modal-map" class="w-full h-64 object-contain bg-black" src="https://placehold.co/768x432/374151/FF453A?text=Track+Map" alt="Track Map">
                <div class="p-6">
                    <p id="modal-date" class="text-sm font-medium text-rose-500 mb-1" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;"></p>
                    <h4 id="modal-gp" class="text-3xl font-bold text-white mb-1">Grand Prix Name</h4>
                    <p id="modal-track" class="text-lg text-gray-400 mb-5" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;"></p>

                    <!-- INSIGHT BLOCK -->
                    <div class="mb-5">
                        <h4 class="text-base font-semibold text-gray-200 mb-2 uppercase tracking-wider">Insight</h4>
                        <p id="modal-insight" class="text-gray-300 text-base" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">Loading insight...</p>
                    </div>

                    <!-- STATS BLOCK -->
                    <div id="modal-stats-block" class="border-t border-gray-700 pt-5" style="display: none;">
                        <h4 class="text-base font-semibold text-gray-200 mb-3 uppercase tracking-wider">Track Stats</h4>
                        <div class="grid grid-cols-2 gap-x-4 gap-y-3 text-base" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">
                            <div class="text-gray-400">Laps: <span id="modal-laps" class="font-semibold text-gray-200">--</span></div>
                            <div class="text-gray-400">Length: <span id="modal-length" class="font-semibold text-gray-200">-- km</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script type="module">
        // NEW: Import GSAP as a module
        import gsap from 'https://cdn.skypack.dev/gsap@3.12.0';
        // ScrollTrigger is not used, so it's not imported.

        // --- DATA ---
        // (Grouped all data together for clarity)

        // League Calendar Data
        const leagueCalendar = [
            { round: 0, gp: "Pre-Season Testing", date: "12/09/25", track: "Suzuka International Racing Course", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Suzuka-International-Racing-Course--768x432.png", insight: "A crucial time for teams to gather data, test new parts, and understand the car before the championship begins at Bahrain.", stats: null },
            { round: 1, gp: "Bahrain Grand Prix", date: "19/09/25", track: "Bahrain International Circuit", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Bahrain-circuit-768x432.png", insight: "A 'stop and go' track known for heavy braking zones and good overtaking opportunities, especially into Turns 1 and 4. Tire degradation is a major factor.", stats: { laps: 29, length: "5.412 km" } },
            { round: 2, gp: "Australian Grand Prix", date: "26/09/25", track: "Albert Park Circuit", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Albert-Park-Circuit-768x432.png", insight: "A fast, flowing street circuit with multiple DRS zones. It's a high-speed track that feels like a permanent circuit. Key overtaking spots are Turns 1, 3, and 9.", stats: { laps: 29, length: "5.278 km" } },
            { round: 3, gp: "Emilia Romagna Grand Prix", date: "03/10/25", track: "Autodromo Enzo e Dino Ferrari (Imola)", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Autodromo-Enzo-e-Dino-Ferrari-768x432.png", insight: "An old-school, narrow track with punishing gravel traps. It's fast, unforgiving, and very technical. Overtaking is notoriously difficult, so qualifying and strategy are critical.", stats: { laps: 32, length: "4.909 km" } },
            { round: 4, gp: "Spanish Grand Prix", date: "10/10/25", track: "Circuit de Barcelona-Catalunya", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2024/02/Circuit-de-Barcelona-768x432.png", insight: "A well-known test track with a great mix of high and low-speed corners. The long, sweeping Turn 3 is a true test of car balance. Tire management is crucial here.", stats: { laps: 33, length: "4.657 km" } },
            { round: "break", gp: "Season Break", date: "", track: "Time for teams to regroup and upgrade.", mapUrl: "https://placehold.co/768x432/1f2937/FF453A?text=SEASON+BREAK", insight: "A mid-season break for teams to analyze performance, develop upgrades, and for drivers to recharge.", stats: null },
            { round: 5, gp: "Great Britain Grand Prix", date: "24/10/25", track: "Silverstone Circuit", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Silverstone-Circuit--768x432.png", insight: "An iconic, high-speed circuit featuring legendary corners like Maggotts, Becketts, and Chapel. Requires high downforce and strong aerodynamic efficiency.", stats: { laps: 26, length: "5.891 km" } },
            { round: 6, gp: "Las Vegas Grand Prix", date: "31/10/25", track: "Las Vegas Strip Circuit", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2024/02/Las-Vegas-GP-768x432.png", insight: "A fast street circuit with long straights, especially down the famous Strip. Expect high top speeds, heavy braking, and many overtaking opportunities.", stats: { laps: 25, length: "6.201 km" } },
            { round: 7, gp: "Belgian Grand Prix", date: "07/11/25", track: "Circuit de Spa-Francorchamps", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Circuit-de-Spa-Francorchamps-768x432.png", insight: "A driver favorite, known for its length, elevation changes, and the iconic Eau Rouge/Raidillon sequence. It's a high-speed, low-downforce track.", stats: { laps: 22, length: "7.004 km" } },
            { round: 8, gp: "Austrian Grand Prix", date: "14/11/25", track: "Red Bull Ring", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Red-Bull-Ring-768x432.png", insight: "A short, 'power' circuit with long straights and heavy uphill braking zones. The lap is very quick. It offers great overtaking opportunities into Turns 1, 3, and 4.", stats: { laps: 36, length: "4.318 km" } },
            { round: 9, gp: "So Paulo Grand Prix", date: "21/11/25", track: "Autdromo Jos Carlos Pace (Interlagos)", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Auto%CC%81dromo-Jose%CC%81-Carlos-Pace--768x432.png", insight: "A classic anti-clockwise track with significant elevation changes. The long uphill run to Turn 1 is a major DRS zone. The 'Senna S' is an iconic opening sequence.", stats: { laps: 36, length: "4.309 km" } },
            { round: 10, gp: "Abu Dhabi Grand Prix", date: "28/11/25", track: "Yas Marina Circuit", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Yas-Marina-Circuit--768x432.png", insight: "A modern circuit with a mix of high-speed straights and a technical final sector. Overtaking was improved with recent layout changes.", stats: { laps: 29, length: "5.281 km" } }
        ];

        // Original data, DO NOT MODIFY
        const driverData = [
            // No 'pos' needed, it will be auto-assigned
            { driver: "Simman", team: "Ferrari", points: 124 },
            { driver: "Wi7ard", team: "Williams", points: 105 },
            { driver: "TheGodfather", team: "Alpine", points: 58 },
            { driver: "Harish", team: "Haas", points: 50 },
            { driver: "ApexEntropy", team: "Alpine", points: 45 },
            { driver: "Overload", team: "McLaren", points: 34 },
            { driver: "Vibin", team: "Aston Martin", points: 33 },
            { driver: "Kentucky", team: "Haas", points: 27 },
            { driver: "Mahesh", team: "Williams", points: 27 },
            { driver: "Oxygen", team: "Kick Sauber", points: 18 },
            { driver: "Memb", team: "Mercedes", points: 18 },
            { driver: "Apurrv", team: "Aston Martin", points: 17 },
            { driver: "Bopedope", team: "McLaren", points: 12 },
            { driver: "Clone", team: "Racing Bulls", points: 8 },
            { driver: "Denji", team: "Red Bull Racing", points: 4 },
            { driver: "Maayaone", team: "Mercedes", points: 0 },
            { driver: "Bala", team: "Kick Sauber", points: 0 },
            { driver: "Dino", team: "Ferrari", points: 0 },
            { driver: "Spartan Gamer", team: "Racing Bulls", points: 0 },
            { driver: "HarryBeckham", team: "Red Bull Racing", points: 0 }
            // Removed Reserve Drivers
        ];
        
        // --- Team Color & Logo Maps ---
        // Used for --color on driver/constructor cards
        const teamColorMap = {
            "Ferrari": "hsl(357, 100%, 49%)", // #DC0000
            "Williams": "hsl(217, 100%, 49%)", // #0082FA
            "Alpine": "hsl(205, 100%, 50%)", // #0090FF
            "Haas": "hsl(220, 3%, 73%)", // #B6B6B8
            "McLaren": "hsl(32, 100%, 50%)", // #FF8700
            "Kick Sauber": "hsl(120, 73%, 58%)", // #52E252
            "Aston Martin": "hsl(172, 100%, 22%)", // #006F62
            "Racing Bulls": "hsl(211, 100%, 64%)", // #469BFF
            "Mercedes": "hsl(174, 100%, 41%)", // #00D2BE
            "Red Bull Racing": "hsl(240, 100%, 48%)", // #0600EF -> REVERTED
            // "Reserve": "hsl(0, 0%, 50%)", // #808080 // Removed
            "default": "hsl(347, 83%, 54%)" // #e11d48
        };
        
        // Used for team logos on driver cards (Nike Style)
        const teamLogoMap = {
            "Ferrari": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/ferrari.png",
            "Williams": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/williams.png",
            "Alpine": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/alpine.png",
            "Haas": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/haas.png",
            "McLaren": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/mclaren.png",
            "Kick Sauber": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/kick_sauber.png",
            "Aston Martin": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/martin.png",
            "Racing Bulls": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/vcarb.png",
            "Mercedes": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/mercedes.png",
            "Red Bull Racing": "https://raw.githubusercontent.com/S-HARISH44/TTRL-RESOURCES/d4faca0970a4d20419af0e364a9e1aebb9af0fe0/LOGOS/redbull.png"
            // "Reserve": "https://placehold.co/200x100/808080/FFFFFF?text=RESERVE" // Removed
        };
        
         // Used for car images on constructor cards (Carousel Style)
        const teamImageMap = {
            "Ferrari": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025ferraricarright.png?raw=true",
            "Williams": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025williamscarright.png?raw=true",
            "Alpine": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025alpinecarright.png?raw=true",
            "Haas": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025haasf1teamcarright.png?raw=true",
            "Aston Martin": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025astonmartincarright.png?raw=true",
            "Kick Sauber": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025kicksaubercarright.png?raw=true",
            "McLaren": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025mclarencarright.png?raw=true",
            "Red Bull Racing": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025redbullracingcarright.png?raw=true",
            "Racing Bulls": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025racingbullscarright.png?raw=true",
            "Mercedes": "https://github.com/S-HARISH44/TTRL/blob/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025mercedescarright.png?raw=true"
        };
        const defaultCarImage = "https://placehold.co/300x400/1f2937/6b7280?text=Car+Image";
        
        // --- END Team Color & Logo Maps ---
        
        
        // --- MUTABLE STATE ---
        // (These will be populated by processStandings)
        let currentDriverStandings = [];
        let currentConstructorStandings = [];


        // --- DATA PROCESSING ---

        /**
         * Calculates and sorts driver and constructor standings from the base data.
         * Populates `currentDriverStandings` and `currentConstructorStandings`.
         */
        function processStandings() {
            // 1. Process Driver Standings
            // Sort drivers by points, descending
            currentDriverStandings = [...driverData].sort((a, b) => {
                // Main drivers sorted by points
                return b.points - a.points;
            });
            
            // Assign positions
            currentDriverStandings.forEach((driver, index) => {
                driver.pos = index + 1;
            });

            // 2. Process Constructor Standings
            const constructorMap = new Map();
            
            // Sum points and collect drivers for each team
            currentDriverStandings.forEach(driver => {
                // Ignore Reserve drivers for constructor standings (if any were left)
                if (driver.team === 'Reserve') return;

                if (!constructorMap.has(driver.team)) {
                    constructorMap.set(driver.team, {
                        team: driver.team,
                        points: 0,
                        drivers: []
                    });
                }
                
                const teamData = constructorMap.get(driver.team);
                teamData.points += driver.points;
                // Store driver name and points for the card
                teamData.drivers.push({ name: driver.driver, points: driver.points });
            });

            // --- NEW: Manual point adjustment for Racing Bulls ---
            if (constructorMap.has("Racing Bulls")) {
                const rbData = constructorMap.get("Racing Bulls");
                // Add 1 point from the previous driver
                rbData.points += 1; 
            }
            // --- END NEW ---

            // Convert map to array
            currentConstructorStandings = Array.from(constructorMap.values());
            
            // Sort constructors by points, descending
            currentConstructorStandings.sort((a, b) => b.points - a.points);
            
            // Assign positions and ensure driver data is sorted by points for display
            currentConstructorStandings.forEach((team, index) => {
                team.pos = index + 1;
                // Sort drivers within the team by points for display
                team.drivers.sort((a, b) => b.points - a.points);
                
                // Ensure there are always two driver entries for the card
                while (team.drivers.length < 2) {
                    team.drivers.push({ name: "N/A", points: 0 });
                }
            });
        }


        // --- UI POPULATION ---

        /**
         * Finds the next race and initializes the countdown timer.
         * @param {HTMLElement} nextRaceGpEl - The h2 element for the GP name.
         * @param {HTMLElement} nextRaceTrackEl - The h3 element for the track name.
         * @param {HTMLElement} countdownEl - The div containing the countdown boxes.
         */
        function initCountdown(nextRaceGpEl, nextRaceTrackEl, countdownEl) {
            const RACE_TIME_UTC = { hours: 17, minutes: 0, seconds: 0 };
            const now = new Date();
            let nextRace = null;

            for (const race of leagueCalendar) {
                if (race.round === 0 || race.round === "break") continue;
                // Parse date as DD/MM/YY
                const [day, month, year] = race.date.split('/').map(Number);
                // Create date object (year, month-1, day)
                const raceDate = new Date(Date.UTC(2000 + year, month - 1, day, RACE_TIME_UTC.hours, RACE_TIME_UTC.minutes, RACE_TIME_UTC.seconds));
                
                if (raceDate > now) {
                    nextRace = race;
                    nextRace.utcDate = raceDate;
                    break; // Found the next race
                }
            }

            if (nextRace) {
                nextRaceGpEl.textContent = nextRace.gp;
                nextRaceTrackEl.textContent = nextRace.track;
                
                // Find elements inside countdownEl
                const daysEl = countdownEl.querySelector('#days');
                const hoursEl = countdownEl.querySelector('#hours');
                const minutesEl = countdownEl.querySelector('#minutes');
                const secondsEl = countdownEl.querySelector('#seconds');

                if (!daysEl || !hoursEl || !minutesEl || !secondsEl) {
                    console.error("Countdown timer boxes (days, hours, etc.) not found!");
                    countdownEl.innerHTML = '<h2 class="col-span-4 text-2xl font-bold text-red-500 text-center py-10">Countdown UI Error.</h2>';
                    return;
                }

                const interval = setInterval(() => {
                    const now = new Date().getTime();
                    const distance = nextRace.utcDate.getTime() - now;

                    if (distance < 0) {
                        clearInterval(interval);
                        countdownEl.innerHTML = '<h2 class="col-span-4 text-4xl font-bold text-green-500 text-center py-10">RACE IS LIVE!</h2>';
                        return;
                    }

                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    daysEl.textContent = String(days).padStart(2, '0');
                    hoursEl.textContent = String(hours).padStart(2, '0');
                    minutesEl.textContent = String(minutes).padStart(2, '0');
                    secondsEl.textContent = String(seconds).padStart(2, '0');
                }, 1000);

            } else {
                // No more races
                nextRaceGpEl.textContent = "SEASON 1 COMPLETE";
                nextRaceTrackEl.textContent = "The championship has concluded!";
                countdownEl.innerHTML = '<h2 class="col-span-4 text-4xl font-bold text-gray-400 text-center py-10">SEE YOU NEXT SEASON</h2>';
            }
        }

        /**
         * Populates the league calendar grid.
         * @param {HTMLElement} grid - The div element to populate.
         */
        function populateCalendar(grid) {
            if (!grid) return;
            grid.innerHTML = '';
            
            // Define colors for calendar cards
            const testingColor = "#0082FA"; // Williams Blue
            const raceColor = "#FF453A"; // TTRL Red -> NEW RED
            
            leagueCalendar.forEach(race => {
                if (race.round === "break") { 
                    grid.innerHTML += `
                        <div class="lg:col-span-3 md:col-span-2 col-span-1 rounded-lg shadow-xl overflow-hidden flex items-center justify-center min-h-[150px] opacity-80 border-2 border-dashed border-gray-700 bg-gray-800/50">
                            <div class="p-6 text-center">
                                <i class="fa-solid fa-pause-circle text-5xl text-gray-500 mb-3"></i>
                                <h3 class="text-3xl font-bold text-white mb-1">${race.gp}</h3>
                                <p class="text-base text-gray-400" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">${race.track}</p>
                            </div>
                        </div>`;
                    return; 
                }
                
                const isTesting = race.round === 0;
                const roundText = isTesting ? "TESTING" : `RND ${race.round}`;
                const activeColor = isTesting ? testingColor : raceColor;
                const tagBg = isTesting ? 'bg-blue-600' : 'bg-rose-600';
                const tagText = isTesting ? 'text-blue-400' : 'text-rose-500';

                const card = `
                    <div data-round="${race.round}" class="calendar-card rounded-lg shadow-xl cursor-pointer bg-gray-800/70 border border-gray-700" style="--active-color: ${activeColor};">
                        <div class="card-content p-6 relative">
                            <div class="absolute top-0 right-0 ${tagBg} text-white font-bold px-3 py-1 m-4 rounded-md text-sm" style="font-family: 'Inter', sans-serif; letter-spacing: normal; text-transform: none;">
                                ${roundText}
                            </div>
                            <p class="card-date text-sm font-medium ${tagText} mb-1" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">${race.date}</p>
                            <h3 class="card-gp text-2xl font-bold text-white mb-1 mt-2">${race.gp}</h3>
                            <p class="card-track text-base text-gray-400" style="font-family: 'Inter', sans-serif; text-transform: none; letter-spacing: normal;">${race.track}</p>
                        </div>
                    </div>`;
                grid.innerHTML += card;
            });
        }

        /**
         * Populates the driver standings card grid.
         * @param {HTMLElement} grid - The div element to populate.
         */
        function populateDriverCards(grid) {
            if (!grid) return;
            grid.innerHTML = ''; // Clear existing content

            currentDriverStandings.forEach((driver) => { // Use new sorted array
                const teamColor = teamColorMap[driver.team] || teamColorMap['default'];
                const logoUrl = teamLogoMap[driver.team] || `https://placehold.co/200x100/1f2937/6b7280?text=Logo`;
                const driverName = driver.driver;

                const cardHTML = `
                <div class="card" style="--color: ${teamColor};">
                    <div class="imgBx">
                        <img src="${logoUrl}" alt="${driver.team} Logo" onerror="this.src='https://placehold.co/200x100/1f2937/6b7280?text=Logo'; this.onerror=null;">
                    </div>
                    <div class="contentBx">
                        <h2>${driverName}</h2>
                        
                        <!-- NEW: Always visible points -->
                        <div class="points-display">
                            <span>${driver.points} PTS</span>
                        </div>

                        <div class="details">
                             <div class="detail-item">
                                 <h3>Pos :</h3>
                                 <span>P${driver.pos}</span>
                             </div>
                             <!-- REMOVED Points from here -->
                        </div>
                    </div>
                </div>
                `;
                grid.innerHTML += cardHTML;
            });
        }

        /**
         * Populates the constructor standings carousel.
         * @param {HTMLElement} listContainer - The div element containing the carousel.
         */
        function populateConstructorList(listContainer) {
            if (!listContainer) return;
            
            // Find the paragraph element
            const paragraphElement = listContainer.querySelector('p');
            let carouselHTML = '<div class="carousel">'; // Start carousel wrapper
            
            currentConstructorStandings.forEach((team) => { // Use new sorted array
                const carImageUrl = teamImageMap[team.team] || defaultCarImage;
                // Get drivers from the new array structure
                const driver1 = team.drivers[0];
                const driver2 = team.drivers[1];
                // ADDED: Get the team color
                const teamColor = teamColorMap[team.team] || teamColorMap['default'];
                
                carouselHTML += `
                <!-- ADDED: Inline style to set the --color variable -->
                <div class="carousel-item" style="--color: ${teamColor};">
                    <div class="carousel-box">
                        <div class="title">${team.team}</div>
                        <div class="num">${String(team.pos).padStart(2, '0')}</div>
                        <img src="${carImageUrl}" alt="${team.team} Car" onerror="this.src='${defaultCarImage}'; this.onerror=null;" />
                        <div class="drivers">
                             <span class="team-points">${team.points} PTS</span>
                             <span>${driver1.name}: ${driver1.points}</span>
                             <span>${driver2.name}: ${driver2.points}</span>
                        </div>
                    </div>
                </div>
                `;
            });
            
            carouselHTML += '</div>'; // End carousel wrapper
            
             // Replace container content, keeping the paragraph if it exists
             if (paragraphElement) {
                 listContainer.innerHTML = carouselHTML + paragraphElement.outerHTML;
             } else {
                 listContainer.innerHTML = carouselHTML; 
             }
             
             // --- After populating, initialize the carousel script ---
             initializeCarousel(listContainer.querySelector('.carousel'));
        }
        
        
        // --- ANIMATIONS & EFFECTS ---

        /**
         * Initializes the constructor carousel logic.
         * @param {HTMLElement} carouselElement - The carousel div.
         */
        function initializeCarousel(carouselElement) {
            if (!carouselElement) {
                // console.error("Carousel element not found for initialization.");
                return;
            }
            
            let progress = 50;
            let startX = 0;
            let active = 0;
            let isDown = false;

            const speedWheel = 0.02;
            const speedDrag = -0.1;

            const $items = carouselElement.querySelectorAll('.carousel-item');
            const $cursors = document.querySelectorAll('.cursor');
            
            if ($items.length === 0) return; // No items to init

            const getZindex = (array, index) => (array.map((_, i) => (index === i) ? array.length : array.length - Math.abs(index - i)));

            const displayItems = (item, index, active) => {
                const zIndex = getZindex([...$items], active)[index];
                item.style.setProperty('--zIndex', zIndex);
                item.style.setProperty('--active', (index - active) / $items.length);
            }

            const animate = () => {
                progress = Math.max(0, Math.min(progress, 100));
                active = Math.floor(progress / 100 * ($items.length - 1));
                
                $items.forEach((item, index) => displayItems(item, index, active));
            }
            animate();

            $items.forEach((item, i) => {
                item.addEventListener('click', () => {
                    progress = (i / ($items.length - 1)) * 100; // Corrected progress logic
                    animate();
                });
            });

            const handleWheel = e => {
                e.preventDefault(); // Prevent page scroll while over carousel
                const wheelProgress = e.deltaY * speedWheel;
                progress = progress + wheelProgress;
                animate();
            }

            const handleMouseMove = (e) => {
                if (e.type === 'mousemove') {
                    $cursors.forEach(($cursor) => {
                        $cursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
                    });
                }
                if (!isDown) return;
                const x = e.clientX || (e.touches && e.touches[0].clientX) || 0;
                const mouseProgress = (x - startX) * speedDrag;
                progress = progress + mouseProgress;
                startX = x;
                animate();
            }

            const handleMouseDown = e => {
                isDown = true;
                startX = e.clientX || (e.touches && e.touches[0].clientX) || 0;
            }

            const handleMouseUp = () => {
                isDown = false;
            }

            // Attach listeners to the carousel element
            carouselElement.addEventListener('wheel', handleWheel, { passive: false });
            carouselElement.addEventListener('mousedown', handleMouseDown);
            carouselElement.addEventListener('mousemove', handleMouseMove);
            carouselElement.addEventListener('mouseup', handleMouseUp);
            carouselElement.addEventListener('mouseleave', handleMouseUp); // Stop dragging if mouse leaves
            carouselElement.addEventListener('touchstart', handleMouseDown, { passive: true });
            carouselElement.addEventListener('touchmove', handleMouseMove, { passive: true });
            carouselElement.addEventListener('touchend', handleMouseUp);
            
            // Also add mouse move to document for cursor
            document.addEventListener('mousemove', (e) => {
                 if (e.type === 'mousemove') {
                    $cursors.forEach(($cursor) => {
                        $cursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
                    });
                }
            });
        }

        /**
         * Initializes the three.js loading screen animation.
         * @param {HTMLElement} container - The loading screen div.
         * @returns {Function} A cleanup function to stop animation and dispose resources.
         */
        function initLoadingAnimation(container) {
            if (!container || !window.THREE) {
                console.warn("THREE.js not loaded or loading container not found. Skipping loading animation.");
                if (container) container.classList.add('hidden'); // Hide immediately
                return () => {}; // Return empty cleanup function
            }

            let scene, camera, renderer, shape, tl, animationFrameId;

            // 1. Scene
            scene = new THREE.Scene();

            // 2. Camera
            camera = new THREE.OrthographicCamera( window.innerWidth / - 2, window.innerWidth / 2, window.innerHeight / 2, window.innerHeight / - 2, 1, 1000 );
            camera.position.set(500, 500, 500);
            camera.lookAt(scene.position);
            camera.updateProjectionMatrix();

            // 3. Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setClearColor( 0x202020, 1 );
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild( renderer.domElement );

            // 4. Lights
            const shadowlight = new THREE.DirectionalLight( 0xffffff, 1.8 );
            shadowlight.position.set( 0, 50, 0 );
            shadowlight.castShadow = true;
            shadowlight.shadow.darkness = 0.1; 
            scene.add(shadowlight);

            const light = new THREE.DirectionalLight( 0xffffff, 1.8 );
            light.position.set( 60, 100, 20 );
            scene.add(light);
            
            const backLight = new THREE.DirectionalLight( 0xffffff, 1 );
            backLight.position.set( -40, 100, 20 );
            scene.add(backLight);

            // 5. Shape
            const geometry = new THREE.BoxGeometry( 50, 50, 50 );
            const material = new THREE.MeshLambertMaterial({color : 0xF9F8ED, flatShading: true});
            shape = new THREE.Mesh(geometry, material);
            shape.castShadow = true;
            shape.receiveShadow = false;
            scene.add(shape);

            // 6. Animation (GSAP 3)
            tl = gsap.timeline({ repeat: -1 ,repeatDelay:0.5 }); // Use imported gsap
            tl.to(shape.scale, {duration: 0.5, x: 2, ease: "expo.out"});
            tl.to(shape.scale, {duration: 0.5, z: 2, ease: "expo.out"});
            tl.to(shape.scale, {duration: 1, y: 2, ease: "elastic.out"});
            tl.to(shape.scale, {duration: 0.7, z: 1, x:1, y:1, ease: "expo.out"});
            tl.to(shape.rotation, {duration: 0.7, y:-Math.PI, ease: "expo.out"}, "=-0.7");

            // 7. Render loop
            function render() {
                animationFrameId = requestAnimationFrame(render);
                renderer.render(scene, camera);
            }
            render();

            // 8. Resize handler
            function onWindowResize() {
                camera.left = window.innerWidth / - 2;
                camera.right = window.innerWidth / 2;
                camera.top = window.innerHeight / 2;
                camera.bottom = window.innerHeight / - 2;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );
            }
            window.addEventListener( 'resize', onWindowResize, false );
            
            // 9. Cleanup function
            return function cleanup() {
                window.removeEventListener('resize', onWindowResize);
                cancelAnimationFrame(animationFrameId);
                tl.kill(); // Stop GSAP animation
                scene.remove(shape);
                geometry.dispose();
                material.dispose();
                // Dispose lights if needed
                renderer.dispose();
                if (container.contains(renderer.domElement)) {
                    container.removeChild(renderer.domElement);
                }
                scene = null;
                camera = null;
                renderer = null;
            }
        }
        
        /**
         * Links page scroll to video playback time.
         */
        function initVideoScrubbing(video) {
            if (!video) {
                console.warn("Video element #scroll-video not found.");
                return;
            }

            const setupVideoScrubbing = () => {
                video.pause();
                video.currentTime = 0;
                
                // --- THIS IS THE MODIFIED LOGIC ---
                const homeSection = document.getElementById('home');
                // MODIFIED: Changed from 'standings' to 'calendar'
                const calendarSection = document.getElementById('calendar'); 
                
                // MODIFIED: Check for calendarSection
                if (!calendarSection || !homeSection) {
                    console.error("Home or Calendar section not found. Video scrubbing will link to full page.");
                    // Fallback to old behavior if sections aren't found
                    window.addEventListener('scroll', () => {
                        const totalScrollableHeight = document.documentElement.scrollHeight - window.innerHeight;
                        if (totalScrollableHeight <= 0) return; 
                        const scrollProgress = window.scrollY / totalScrollableHeight;
                        if (video.duration && isFinite(video.duration)) {
                            const targetTime = scrollProgress * video.duration;
                            requestAnimationFrame(() => { video.currentTime = targetTime; });
                        }
                    });
                    return; // Exit function
                }

                // New logic:
                // Start scrubbing at the top of the home section
                const scrubStartScrollY = homeSection.offsetTop;
                // End scrubbing when the top of #calendar hits the top of the viewport
                // MODIFIED: Use calendarSection.offsetTop
                const scrubEndScrollY = calendarSection.offsetTop; 
                
                // The total scroll distance over which the video should animate
                const scrubDistance = scrubEndScrollY - scrubStartScrollY;
                
                window.addEventListener('scroll', () => {
                    if (scrubDistance <= 0) return; // Avoid division by zero
                    
                    // Calculate how far we've scrolled *relative to the start*
                    const relativeScroll = window.scrollY - scrubStartScrollY;
                    
                    // Calculate progress (0 to 1) over the defined scrub distance
                    let scrollProgress = relativeScroll / scrubDistance;
                    
                    // Clamp progress between 0 and 1
                    // Before 'home' (if possible), progress is 0.
                    // After 'calendar', progress is 1.
                    scrollProgress = Math.min(1, Math.max(0, scrollProgress)); 
                    
                    if (video.duration && isFinite(video.duration)) {
                        const targetTime = scrollProgress * video.duration;
                        requestAnimationFrame(() => { video.currentTime = targetTime; });
                    }
                });
                // --- END OF MODIFIED LOGIC ---
            };

            // --- THIS IS THE FIX ---
            // Check if metadata is already loaded (readyState >= 1 means HAVE_METADATA)
            if (video.readyState >= 1) {
                setupVideoScrubbing();
            } else {
                // Otherwise, wait for it
                video.addEventListener('loadedmetadata', setupVideoScrubbing);
            }
            // --- END OF FIX ---
            
            video.addEventListener('error', (e) => console.error("Error loading video:", e));
            
            // Explicitly tell the browser to load the video.
            // This works with preload="auto" and helps ensure it starts.
            video.load();
        }

        
        // --- EVENT HANDLERS ---

        /**
         * Sets up the Driver / Constructor standings tabs.
         */
        function setupTabs(driversTab, constructorsTab, driversContainer, constructorsContainer) {
            if (!driversTab || !constructorsTab || !driversContainer || !constructorsContainer) {
                console.warn("Tab elements not found. Skipping tab setup.");
                return;
            }

            driversTab.addEventListener('click', () => {
                driversContainer.style.display = 'block';
                constructorsContainer.style.display = 'none';
                driversTab.classList.add('tab-active');
                driversTab.classList.remove('tab-inactive');
                constructorsTab.classList.add('tab-inactive');
                constructorsTab.classList.remove('tab-active');
            });

            constructorsTab.addEventListener('click', () => {
                driversContainer.style.display = 'none';
                constructorsContainer.style.display = 'block';
                constructorsTab.classList.add('tab-active');
                constructorsTab.classList.remove('tab-inactive');
                driversTab.classList.add('tab-inactive');
                driversTab.classList.remove('tab-active');
            });
        }

        /**
         * Sets up the main overlay navigation menu.
         */
        function setupOverlayNavigation() {
            const overlay = document.querySelector('.overlay-navigation');
            const menuBtn = document.querySelector('.menu.open-overlay');
            
            if (!overlay || !menuBtn) {
                console.warn("Overlay navigation elements not found. Skipping nav setup.");
                return;
            }

            menuBtn.addEventListener('click', e => {
                e.preventDefault();
                
                if (overlay.classList.contains('overlay-active')) {
                    // Closing
                    menuBtn.classList.remove('active');
                    overlay.classList.add('overlay-slide-up');
                    // Remove 'overlay-active' after the slide-up transition ends
                    setTimeout(() => {
                         overlay.classList.remove('overlay-active', 'overlay-slide-up');
                    }, 800); // Match longest reverse animation
                } else {
                    // Opening
                    menuBtn.classList.add('active');
                    overlay.classList.remove('overlay-slide-up'); // Ensure this is removed
                    overlay.classList.add('overlay-active');
                }
            });

            // Close menu when a link is clicked
            document.querySelectorAll('.overlay-navigation a').forEach(link => {
                link.addEventListener('click', () => {
                    if (overlay.classList.contains('overlay-active')) {
                        menuBtn.classList.remove('active');
                        overlay.classList.add('overlay-slide-up');
                        setTimeout(() => {
                             overlay.classList.remove('overlay-active', 'overlay-slide-up');
                        }, 800);
                    }
                });
            });
        }

        /**
         * Sets up the calendar modal functionality.
         * @param {HTMLElement} modal - The main modal container.
         * @param {HTMLElement} grid - The calendar grid.
         * @param {Object} modalEls - An object containing all modal child elements.
         */
        function setupCalendarModal(modal, grid, modalEls) {
            // Check for essential elements
            if (!modal || !grid || !modalEls.modalBackdrop || !modalEls.modalContent || !modalEls.closeBtn) {
                console.warn("Calendar modal elements not found. Skipping modal setup.");
                return;
            }

            function openModal(race) {
                if (!race) return;
                
                // Use the passed-in elements from modalEls
                modalEls.modalTitle.textContent = `${race.gp} Insights`;
                modalEls.modalMap.src = race.mapUrl;
                modalEls.modalMap.alt = `${race.track} Map`;
                modalEls.modalMap.onerror = () => {
                    modalEls.modalMap.src = `https::/placehold.co/768x432/374151/FF453A?text=Map+Error`;
                    modalEls.modalMap.alt = 'Track map loading error';
                };
                modalEls.modalDate.textContent = race.date;
                modalEls.modalGp.textContent = race.gp;
                modalEls.modalTrack.textContent = race.track;
                modalEls.modalInsight.textContent = race.insight;

                if (race.stats) {
                    modalEls.modalLaps.textContent = race.stats.laps;
                    modalEls.modalLength.textContent = race.stats.length;
                    modalEls.modalStatsBlock.style.display = 'block';
                } else {
                    modalEls.modalStatsBlock.style.display = 'none';
                }
                
                modal.style.display = 'flex';
                setTimeout(() => {
                    modal.style.opacity = '1';
                    modalEls.modalContent.style.transform = 'scale(1)';
                    modalEls.modalContent.style.opacity = '1';
                }, 10);
            }

            function closeModal() {
                modalEls.modalContent.style.transform = 'scale(0.95)';
                modalEls.modalContent.style.opacity = '0';
                modal.style.opacity = '0';
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }

            grid.addEventListener('click', (e) => {
                const card = e.target.closest('.calendar-card[data-round]');
                if (card) {
                    const roundValue = card.dataset.round;
                    if (roundValue === "break") return;
                    const round = Number(roundValue);
                    const raceData = leagueCalendar.find(r => r.round === round);
                    openModal(raceData);
                }
            });

            modalEls.closeBtn.addEventListener('click', closeModal);
            modalEls.modalBackdrop.addEventListener('click', closeModal);
            
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.style.display !== 'none') {
                    closeModal();
                }
            });
        }
        
        // --- APP ENTRY POINT ---

        /**
         * Main function to initialize the application.
         */
        function main() {
            // --- 1. Cache DOM Elements ---
            const DOM = {
                // Loading
                loadingScreen: document.getElementById('loading-screen'),
                // General
                yearSpan: document.getElementById('current-year'),
                // Countdown
                nextRaceGp: document.getElementById('next-race-gp'),
                nextRaceTrack: document.getElementById('next-race-track'),
                countdown: document.getElementById('countdown'),
                // Calendar
                calendarGrid: document.getElementById('calendar-grid'),
                // Standings
                driversTab: document.getElementById('drivers-tab'),
                constructorsTab: document.getElementById('constructors-tab'),
                driversContainer: document.getElementById('drivers-table-container'),
                constructorsContainer: document.getElementById('constructors-list-container'),
                driverCardGrid: document.getElementById('driver-card-grid'),
                // Modal
                calendarModal: document.getElementById('calendar-modal'),
                modalBackdrop: document.getElementById('modal-backdrop'),
                modalContent: document.querySelector('#calendar-modal .modal-content'),
                modalCloseBtn: document.getElementById('modal-close-btn'),
                modalTitle: document.getElementById('modal-title'),
                modalMap: document.getElementById('modal-map'),
                modalDate: document.getElementById('modal-date'),
                modalGp: document.getElementById('modal-gp'),
                modalTrack: document.getElementById('modal-track'),
                modalInsight: document.getElementById('modal-insight'),
                modalLaps: document.getElementById('modal-laps'),
                modalLength: document.getElementById('modal-length'),
                modalStatsBlock: document.getElementById('modal-stats-block'),
                // Video & Scroll
                video: document.getElementById('scroll-video')
                // (REMOVED) scroller, scrollerThumb, scrollerTrack, scrollerStyles
            };

            // --- 2. Initialize Loading Screen (Runs First) ---
            const cleanupLoadingAnimation = initLoadingAnimation(DOM.loadingScreen);
            const animationDuration = 3500, fadeDuration = 500;
            if (DOM.loadingScreen) { // Add check in case it's missing
                DOM.loadingScreen.style.transition = `opacity ${fadeDuration}ms ease-out, visibility ${fadeDuration}ms ease-out`;
                setTimeout(() => { 
                    DOM.loadingScreen.classList.add('hidden');
                    if (cleanupLoadingAnimation) cleanupLoadingAnimation();
                }, animationDuration + fadeDuration);
            }

            // --- 3. Process Data ---
            processStandings();

            // --- 4. Populate UI ---
            if (DOM.yearSpan) DOM.yearSpan.textContent = new Date().getFullYear();
            if (DOM.nextRaceGp && DOM.nextRaceTrack && DOM.countdown) {
                initCountdown(DOM.nextRaceGp, DOM.nextRaceTrack, DOM.countdown);
            }
            populateCalendar(DOM.calendarGrid);
            populateDriverCards(DOM.driverCardGrid);
            populateConstructorList(DOM.constructorsContainer);

            // --- 5. Initialize Effects & Handlers ---
            initVideoScrubbing(DOM.video);
            // (REMOVED) initializeCurvedScrollbar(...) call
            setupTabs(DOM.driversTab, DOM.constructorsTab, DOM.driversContainer, DOM.constructorsContainer);
            setupOverlayNavigation();
            
            // Modal elements grouped for convenience
            const modalEls = {
                modalBackdrop: DOM.modalBackdrop,
                modalContent: DOM.modalContent,
                closeBtn: DOM.modalCloseBtn,
                modalTitle: DOM.modalTitle, 
                modalMap: DOM.modalMap, 
                modalDate: DOM.modalDate, 
                modalGp: DOM.modalGp, 
                modalTrack: DOM.modalTrack, 
                modalInsight: DOM.modalInsight, 
                modalLaps: DOM.modalLaps, 
                modalLength: DOM.modalLength, 
                modalStatsBlock: DOM.modalStatsBlock
            };
            setupCalendarModal(DOM.calendarModal, DOM.calendarGrid, modalEls);
        }

        // --- 6. Run App ---
        document.addEventListener('DOMContentLoaded', main);

    </script>
    
    <!-- MOVED Tailwind Script to end of body -->
    <script src="https://cdn.tailwindcss.com"></script>
</body>
</html>
